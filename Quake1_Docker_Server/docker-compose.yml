

# =========================
# Nätverk
# =========================
networks:
  quake_net:        # Quake-serverns nätverk
    driver: bridge
  wg_net:           # WireGuard VPN nätverk
    driver: bridge

# =========================
# Services
# =========================
services:
  quake_server:
    image: zobees/quakeworld:latest      # Must have: Quake-server image
    platform: linux/amd64                # Kör x86_64 image även på Mac M1/M2
    container_name: quake_server
    ports:
      - "26000:26000/udp"                # Must have: UDP-port 26000 exposad
    volumes:
      - ./game/id1_files:/id1            # Must have: pak0.pak & pak1.pak
      - ./configs/server.cfg:/server.cfg # Should have: server config
      - quake_data:/data                  # Must have: persistent volume
      # - ./dashboard:/dashboard         # Could have: webbaserat dashboard
    networks:
      - quake_net                         # Must have: separat nätverk
    restart: unless-stopped               # Could have: auto-start

  wireguard:
    image: linuxserver/wireguard          # Should have: VPN
    container_name: wireguard
    cap_add:
      - NET_ADMIN
      - SYS_MODULE
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Stockholm
      - SERVERURL=auto
      - SERVERPORT=51820
      - PEERS=1
      - PEERDNS=1.1.1.1
    volumes:
      - ./wg-config:/config                # Should have: persistent WireGuard config
    ports:
      - "51820:51820/udp"
    sysctls:
      - net.ipv4.conf.all.src_valid_mark=1
    networks:
      - wg_net
    restart: unless-stopped

# =========================
# Persistenta volymer
# =========================
volumes:
  quake_data:
  wg_config:
  # dashboard_data:                         # Could have: persistent volume för dashboard